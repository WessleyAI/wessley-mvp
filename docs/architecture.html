<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wessley.ai ‚Äî Design Patterns Architecture</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0b0f1a; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; overflow-x: hidden; }
  
  h1 { text-align: center; padding: 28px 0 4px; font-size: 26px; color: #fff; letter-spacing: -0.5px; }
  h2 { font-size: 18px; color: #fff; margin: 32px 0 16px; padding-left: 20px; letter-spacing: -0.3px; }
  .subtitle { text-align: center; color: #6b7280; font-size: 13px; margin-bottom: 12px; }
  
  /* Legend */
  .legend { display: flex; justify-content: center; gap: 18px; flex-wrap: wrap; padding: 12px 16px; }
  .legend span { display: flex; align-items: center; gap: 6px; font-size: 11px; color: #94a3b8; }
  .legend i { width: 28px; height: 3px; border-radius: 2px; display: inline-block; }
  
  /* Tooltip */
  .tip { display: none; position: fixed; background: #1e2433; border: 1px solid #334155; border-radius: 10px; padding: 14px 16px; max-width: 380px; z-index: 999; box-shadow: 0 12px 40px rgba(0,0,0,0.7); font-size: 12px; line-height: 1.6; color: #cbd5e1; pointer-events: none; }
  .tip.show { display: block; }
  .tip b { color: #fff; }
  .tip code { background: #0f172a; border: 1px solid #334155; border-radius: 4px; padding: 1px 5px; font-size: 11px; color: #a78bfa; font-family: 'SF Mono', 'Fira Code', monospace; }
  .tip pre { background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 8px 10px; margin: 6px 0 2px; font-size: 10.5px; line-height: 1.5; color: #e2e8f0; font-family: 'SF Mono', 'Fira Code', monospace; overflow-x: auto; white-space: pre; }
  
  /* Main SVG */
  .arch-svg { display: block; margin: 0 auto; }
  
  /* Flow selector */
  .flow-selector { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; padding: 8px 16px 16px; }
  .flow-btn { background: #1e2433; border: 1px solid #334155; border-radius: 8px; padding: 8px 16px; font-size: 12px; color: #94a3b8; cursor: pointer; transition: all 0.3s; font-family: inherit; }
  .flow-btn:hover { border-color: #60a5fa; color: #e0e0e0; }
  .flow-btn.active { border-color: var(--fc); color: var(--fc); background: rgba(96,165,250,0.08); box-shadow: 0 0 12px rgba(96,165,250,0.15); }
  .flow-btn .dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; vertical-align: middle; }
  
  /* Dash animation */
  @keyframes dash { to { stroke-dashoffset: -40; } }
  .flow-path { stroke-dasharray: 8,6; stroke-dashoffset: 0; animation: dash 1.2s linear infinite; opacity: 0; transition: opacity 0.4s; }
  .flow-path.visible { opacity: 0.85; }
  
  /* Glow */
  .svc-card { transition: filter 0.3s, transform 0.3s; cursor: pointer; }
  .svc-card:hover { filter: url(#glow); }
  .svc-card.highlighted { filter: url(#glow-strong); }
  
  /* Badge */
  .badge { font-size: 9px; fill: #0b0f1a; font-weight: 600; }
  
  /* Foundation section */
  .foundation { max-width: 1160px; margin: 0 auto; padding: 0 20px; }
  .fn-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 10px; padding: 0 20px 20px; max-width: 1160px; margin: 0 auto; }
  .fn-card { background: linear-gradient(180deg, #1a2744 0%, #0f172a 100%); border: 1px solid #334155; border-radius: 10px; padding: 14px; transition: all 0.3s; cursor: default; }
  .fn-card:hover { border-color: #60a5fa; box-shadow: 0 0 16px rgba(96,165,250,0.12); }
  .fn-card h4 { font-size: 13px; color: #60a5fa; margin-bottom: 4px; font-family: 'SF Mono', 'Fira Code', monospace; }
  .fn-card p { font-size: 11px; color: #94a3b8; line-height: 1.5; }
  
  /* Comparison */
  .comparison { max-width: 1160px; margin: 0 auto 32px; padding: 0 20px; display: flex; gap: 20px; justify-content: center; }
  .cmp-card { flex: 1; max-width: 500px; background: linear-gradient(180deg, #1e2433 0%, #0f172a 100%); border: 1px solid #334155; border-radius: 12px; padding: 24px; position: relative; overflow: hidden; }
  .cmp-card h3 { font-size: 15px; margin-bottom: 12px; }
  .cmp-card.before h3 { color: #f43f5e; }
  .cmp-card.after h3 { color: #4ade80; }
  .cmp-card .stat { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #1e293b; font-size: 13px; }
  .cmp-card .stat:last-child { border-bottom: none; }
  .cmp-card .stat .label { color: #94a3b8; }
  .cmp-card .stat .val { color: #fff; font-weight: 600; font-size: 18px; }
  .cmp-card.before .stat .val { color: #f43f5e; }
  .cmp-card.after .stat .val { color: #4ade80; }
  .cmp-arrow { display: flex; align-items: center; font-size: 28px; color: #475569; }
  
  /* Reduction bar */
  .bar-row { display: flex; align-items: center; gap: 10px; margin: 6px 0; }
  .bar-label { font-size: 11px; color: #94a3b8; width: 80px; text-align: right; }
  .bar-track { flex: 1; height: 14px; background: #1e293b; border-radius: 7px; overflow: hidden; position: relative; }
  .bar-fill { height: 100%; border-radius: 7px; transition: width 1s ease; }
  .bar-fill.before { background: #f43f5e; opacity: 0.6; }
  .bar-fill.after { background: #4ade80; }
  
  .footer { text-align: center; color: #475569; font-size: 11px; padding: 24px 12px 16px; }
  
  /* Section divider */
  .section-divider { width: 100%; max-width: 1160px; margin: 0 auto; height: 1px; background: linear-gradient(90deg, transparent, #334155, transparent); }
</style>
</head>
<body>

<h1>‚öôÔ∏è Wessley.ai ‚Äî Design Patterns Architecture</h1>
<p class="subtitle">Consolidated Service Design ¬∑ Data Flow Pipelines ¬∑ pkg/fn Foundation</p>

<div class="legend">
  <span><i style="background:#60a5fa"></i> api (Go)</span>
  <span><i style="background:#a78bfa"></i> engine (Go)</span>
  <span><i style="background:#f97316"></i> ml-worker (Python)</span>
  <span><i style="background:#4ade80"></i> Data Stores</span>
  <span><i style="background:#a78bfa;opacity:0.5"></i> NATS JetStream</span>
</div>

<!-- Flow Selector -->
<div class="flow-selector">
  <button class="flow-btn" data-flow="query" style="--fc:#60a5fa" onclick="toggleFlow('query',this)">
    <span class="dot" style="background:#60a5fa"></span>User Query
  </button>
  <button class="flow-btn" data-flow="ingest" style="--fc:#a78bfa" onclick="toggleFlow('ingest',this)">
    <span class="dot" style="background:#a78bfa"></span>Knowledge Ingestion
  </button>
  <button class="flow-btn" data-flow="model3d" style="--fc:#f97316" onclick="toggleFlow('model3d',this)">
    <span class="dot" style="background:#f97316"></span>3D Model Generation
  </button>
  <button class="flow-btn" data-flow="flywheel" style="--fc:#4ade80" onclick="toggleFlow('flywheel',this)">
    <span class="dot" style="background:#4ade80"></span>ML Flywheel
  </button>
</div>

<!-- Main Architecture SVG -->
<svg class="arch-svg" viewBox="0 0 1160 620" width="100%" style="max-width:1160px">
  <defs>
    <marker id="a-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#60a5fa"/></marker>
    <marker id="a-purple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#a78bfa"/></marker>
    <marker id="a-orange" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#f97316"/></marker>
    <marker id="a-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#4ade80"/></marker>
    <marker id="a-white" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><path d="M0,0 L8,3 L0,6" fill="#94a3b8"/></marker>
    
    <filter id="glow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    <filter id="glow-strong"><feGaussianBlur stdDeviation="4" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    
    <linearGradient id="g-api" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#1e3a5f"/><stop offset="100%" stop-color="#0f172a"/></linearGradient>
    <linearGradient id="g-engine" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2d1b4e"/><stop offset="100%" stop-color="#0f172a"/></linearGradient>
    <linearGradient id="g-ml" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#3d1f0e"/><stop offset="100%" stop-color="#0f172a"/></linearGradient>
    <linearGradient id="g-data" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#1a3a2a"/><stop offset="100%" stop-color="#0f172a"/></linearGradient>
    <linearGradient id="g-nats" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#1e3a5f" stop-opacity="0.3"/><stop offset="50%" stop-color="#2d1b4e" stop-opacity="0.4"/><stop offset="100%" stop-color="#1e3a5f" stop-opacity="0.3"/></linearGradient>
  </defs>

  <!-- ‚îÄ‚îÄ User ‚îÄ‚îÄ -->
  <rect x="20" y="30" width="130" height="50" rx="10" fill="#1e2433" stroke="#334155" stroke-width="1" class="svc-card"
    data-tip="<b>User / Client</b><br>Browser or API consumer. Connects via HTTPS/WSS to api service."/>
  <text x="85" y="52" text-anchor="middle" fill="#fff" font-size="12" font-weight="600">üë§ User</text>
  <text x="85" y="67" text-anchor="middle" fill="#94a3b8" font-size="9">Browser ¬∑ PWA</text>

  <!-- ‚îÄ‚îÄ Source ‚îÄ‚îÄ -->
  <rect x="1010" y="30" width="130" height="50" rx="10" fill="#1e2433" stroke="#f43f5e" stroke-width="0.5" stroke-opacity="0.4" class="svc-card"
    data-tip="<b>External Sources</b><br>Reddit, YouTube, iFixit, NHTSA, forums, parts catalogs."/>
  <text x="1075" y="52" text-anchor="middle" fill="#fff" font-size="12" font-weight="600">üåç Sources</text>
  <text x="1075" y="67" text-anchor="middle" fill="#94a3b8" font-size="9">Reddit ¬∑ iFixit ¬∑ NHTSA</text>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- NATS BUS (horizontal band)              -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <rect x="160" y="120" width="840" height="36" rx="8" fill="url(#g-nats)" stroke="#a78bfa" stroke-width="1" stroke-opacity="0.3"/>
  <text x="580" y="143" text-anchor="middle" fill="#a78bfa" font-size="11" font-weight="600" opacity="0.8">NATS JetStream</text>
  <!-- pulsing dots on bus -->
  <circle cx="300" cy="138" r="3" fill="#a78bfa" opacity="0.6"><animate attributeName="cx" from="200" to="960" dur="3s" repeatCount="indefinite"/><animate attributeName="opacity" values="0.2;0.8;0.2" dur="3s" repeatCount="indefinite"/></circle>
  <circle cx="700" cy="138" r="3" fill="#a78bfa" opacity="0.6"><animate attributeName="cx" from="960" to="200" dur="4s" repeatCount="indefinite"/><animate attributeName="opacity" values="0.2;0.8;0.2" dur="4s" repeatCount="indefinite"/></circle>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- API SERVICE                              -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <g class="svc-card" data-tip="<b>api</b> (Go)<br>HTTP/WS API server, auth middleware, chat/RAG handler, ingestion handler.<br><br><b>Patterns:</b> Middleware Chain, Pipeline, Retry<pre>// Middleware Chain\nchain := fn.Chain(\n  AuthMiddleware,\n  RateLimitMiddleware,\n  LoggingMiddleware,\n)\nhttp.Handle(&quot;/&quot;, chain(handler))</pre>">
    <rect x="60" y="190" width="260" height="140" rx="12" fill="url(#g-api)" stroke="#60a5fa" stroke-width="1.2"/>
    <text x="190" y="215" text-anchor="middle" fill="#60a5fa" font-size="14" font-weight="700">api</text>
    <text x="190" y="232" text-anchor="middle" fill="#94a3b8" font-size="10">Go ¬∑ HTTP/WS ¬∑ Auth ¬∑ Chat/RAG</text>
    <!-- sub-modules -->
    <rect x="75" y="244" width="72" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="111" y="261" text-anchor="middle" fill="#60a5fa" font-size="9">Auth</text>
    <rect x="155" y="244" width="72" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="191" y="261" text-anchor="middle" fill="#60a5fa" font-size="9">Chat/RAG</text>
    <rect x="235" y="244" width="72" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="271" y="261" text-anchor="middle" fill="#60a5fa" font-size="9">Ingest</text>
    <!-- pattern badges -->
    <rect x="75" y="280" width="62" height="16" rx="4" fill="#60a5fa" opacity="0.2"/>
    <text x="106" y="291" text-anchor="middle" fill="#60a5fa" font-size="8" font-weight="600">Chain</text>
    <rect x="143" y="280" width="62" height="16" rx="4" fill="#60a5fa" opacity="0.2"/>
    <text x="174" y="291" text-anchor="middle" fill="#60a5fa" font-size="8" font-weight="600">Pipeline</text>
    <rect x="211" y="280" width="48" height="16" rx="4" fill="#60a5fa" opacity="0.2"/>
    <text x="235" y="291" text-anchor="middle" fill="#60a5fa" font-size="8" font-weight="600">Retry</text>
    <rect x="265" y="280" width="42" height="16" rx="4" fill="#60a5fa" opacity="0.15"/>
    <text x="286" y="291" text-anchor="middle" fill="#60a5fa" font-size="7" font-weight="600">CB</text>
  </g>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- ENGINE SERVICE                           -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <g class="svc-card" data-tip="<b>engine</b> (Go)<br>Scraper, Graph ops (Neo4j), Semantic search (Qdrant), 3D Model Generation (GLB).<br><br><b>Patterns:</b> Pipeline, Strategy, Repository[T], Builder<pre>// Pipeline composition\npipe := fn.NewStage(scrape).\n  Then(extractEntities).\n  Then(storeGraph).\n  Then(embedVectors)\n\nresult := pipe.Run(ctx, source)</pre>">
    <rect x="440" y="190" width="280" height="140" rx="12" fill="url(#g-engine)" stroke="#a78bfa" stroke-width="1.2"/>
    <text x="580" y="215" text-anchor="middle" fill="#a78bfa" font-size="14" font-weight="700">engine</text>
    <text x="580" y="232" text-anchor="middle" fill="#94a3b8" font-size="10">Go ¬∑ Scraper ¬∑ Graph ¬∑ Semantic ¬∑ GLB</text>
    <rect x="455" y="244" width="62" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="486" y="261" text-anchor="middle" fill="#a78bfa" font-size="9">Scraper</text>
    <rect x="523" y="244" width="55" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="551" y="261" text-anchor="middle" fill="#a78bfa" font-size="9">Graph</text>
    <rect x="584" y="244" width="65" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="617" y="261" text-anchor="middle" fill="#a78bfa" font-size="9">Semantic</text>
    <rect x="655" y="244" width="55" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="683" y="261" text-anchor="middle" fill="#a78bfa" font-size="9">GLB</text>
    <!-- badges -->
    <rect x="455" y="280" width="62" height="16" rx="4" fill="#a78bfa" opacity="0.2"/>
    <text x="486" y="291" text-anchor="middle" fill="#a78bfa" font-size="8" font-weight="600">Pipeline</text>
    <rect x="523" y="280" width="62" height="16" rx="4" fill="#a78bfa" opacity="0.2"/>
    <text x="554" y="291" text-anchor="middle" fill="#a78bfa" font-size="8" font-weight="600">Strategy</text>
    <rect x="591" y="280" width="62" height="16" rx="4" fill="#a78bfa" opacity="0.2"/>
    <text x="622" y="291" text-anchor="middle" fill="#a78bfa" font-size="8" font-weight="600">Repo[T]</text>
    <rect x="659" y="280" width="52" height="16" rx="4" fill="#a78bfa" opacity="0.2"/>
    <text x="685" y="291" text-anchor="middle" fill="#a78bfa" font-size="8" font-weight="600">Builder</text>
  </g>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- ML-WORKER SERVICE                        -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <g class="svc-card" data-tip="<b>ml-worker</b> (Python)<br>YOLO object detection, embedding generation, placement inference, model training.<br><br><b>Patterns:</b> Adapter (gRPC bridge), Pipeline<pre># gRPC Adapter bridge\nclass MLAdapter:\n  def detect(self, img) -> List[Detection]:\n    return self.yolo.predict(img)\n  \n  def embed(self, text) -> np.ndarray:\n    return self.model.encode(text)</pre>">
    <rect x="840" y="190" width="260" height="140" rx="12" fill="url(#g-ml)" stroke="#f97316" stroke-width="1.2"/>
    <text x="970" y="215" text-anchor="middle" fill="#f97316" font-size="14" font-weight="700">ml-worker</text>
    <text x="970" y="232" text-anchor="middle" fill="#94a3b8" font-size="10">Python ¬∑ YOLO ¬∑ Embeddings ¬∑ Training</text>
    <rect x="855" y="244" width="60" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="885" y="261" text-anchor="middle" fill="#f97316" font-size="9">YOLO</text>
    <rect x="921" y="244" width="70" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="956" y="261" text-anchor="middle" fill="#f97316" font-size="9">Embed</text>
    <rect x="997" y="244" width="72" height="26" rx="6" fill="#0f172a" stroke="#334155" stroke-width="0.5"/>
    <text x="1033" y="261" text-anchor="middle" fill="#f97316" font-size="9">Placement</text>
    <!-- badges -->
    <rect x="865" y="280" width="72" height="16" rx="4" fill="#f97316" opacity="0.2"/>
    <text x="901" y="291" text-anchor="middle" fill="#f97316" font-size="8" font-weight="600">Adapter</text>
    <rect x="943" y="280" width="62" height="16" rx="4" fill="#f97316" opacity="0.2"/>
    <text x="974" y="291" text-anchor="middle" fill="#f97316" font-size="8" font-weight="600">Pipeline</text>
    <rect x="1011" y="280" width="62" height="16" rx="4" fill="#f97316" opacity="0.2"/>
    <text x="1042" y="291" text-anchor="middle" fill="#f97316" font-size="8" font-weight="600">gRPC</text>
  </g>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- DATA STORES                              -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <g class="svc-card" data-tip="<b>Supabase / Postgres</b><br>Primary relational store. Auth, users, sessions, chat history. Accessed via Repository[T] pattern.">
    <rect x="60" y="420" width="160" height="50" rx="10" fill="url(#g-data)" stroke="#4ade80" stroke-width="1"/>
    <text x="140" y="443" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="600">üêò Supabase/PG</text>
    <text x="140" y="458" text-anchor="middle" fill="#94a3b8" font-size="9">Auth ¬∑ Users ¬∑ History</text>
  </g>
  <g class="svc-card" data-tip="<b>Neo4j</b><br>Knowledge graph store. Vehicles, parts, symptoms, solutions relationships. Queried by engine graph module.">
    <rect x="240" y="420" width="140" height="50" rx="10" fill="url(#g-data)" stroke="#4ade80" stroke-width="1"/>
    <text x="310" y="443" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="600">üîó Neo4j</text>
    <text x="310" y="458" text-anchor="middle" fill="#94a3b8" font-size="9">Knowledge Graph</text>
  </g>
  <g class="svc-card" data-tip="<b>Qdrant</b><br>Vector database for semantic search. Stores embeddings from ml-worker. Queried by engine semantic module.">
    <rect x="400" y="420" width="140" height="50" rx="10" fill="url(#g-data)" stroke="#4ade80" stroke-width="1"/>
    <text x="470" y="443" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="600">üéØ Qdrant</text>
    <text x="470" y="458" text-anchor="middle" fill="#94a3b8" font-size="9">Vector Search</text>
  </g>
  <g class="svc-card" data-tip="<b>Redis</b><br>Caching layer, rate limiting, session store. Used by api for fast lookups.">
    <rect x="560" y="420" width="120" height="50" rx="10" fill="url(#g-data)" stroke="#4ade80" stroke-width="1"/>
    <text x="620" y="443" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="600">‚ö° Redis</text>
    <text x="620" y="458" text-anchor="middle" fill="#94a3b8" font-size="9">Cache ¬∑ Sessions</text>
  </g>
  <g class="svc-card" data-tip="<b>S3 / Object Storage</b><br>Stores generated GLB 3D models, training data, assets. Written by engine, read via CDN.">
    <rect x="700" y="420" width="120" height="50" rx="10" fill="url(#g-data)" stroke="#4ade80" stroke-width="1"/>
    <text x="760" y="443" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="600">üì¶ S3</text>
    <text x="760" y="458" text-anchor="middle" fill="#94a3b8" font-size="9">GLB ¬∑ Assets</text>
  </g>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- STATIC ARROWS (always visible)           -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- User ‚Üí api -->
  <line x1="85" y1="80" x2="120" y2="188" stroke="#60a5fa" stroke-width="1.2" marker-end="url(#a-blue)" opacity="0.4"/>
  <!-- api ‚Üí NATS -->
  <line x1="190" y1="190" x2="250" y2="156" stroke="#a78bfa" stroke-width="1" marker-end="url(#a-purple)" opacity="0.3"/>
  <!-- engine ‚Üí NATS -->
  <line x1="580" y1="190" x2="580" y2="156" stroke="#a78bfa" stroke-width="1" marker-end="url(#a-purple)" opacity="0.3"/>
  <!-- ml-worker ‚Üí NATS (via engine) -->
  <line x1="970" y1="190" x2="900" y2="156" stroke="#a78bfa" stroke-width="1" marker-end="url(#a-purple)" opacity="0.3"/>
  <!-- Source ‚Üí engine -->
  <line x1="1075" y1="80" x2="970" y2="188" stroke="#f97316" stroke-width="1" marker-end="url(#a-orange)" opacity="0.3"/>
  <!-- api ‚Üí Postgres -->
  <line x1="120" y1="330" x2="130" y2="418" stroke="#4ade80" stroke-width="1" marker-end="url(#a-green)" opacity="0.3"/>
  <!-- api ‚Üí Redis -->
  <line x1="280" y1="330" x2="600" y2="418" stroke="#4ade80" stroke-width="1" marker-end="url(#a-green)" opacity="0.2"/>
  <!-- engine ‚Üí Neo4j -->
  <line x1="520" y1="330" x2="330" y2="418" stroke="#4ade80" stroke-width="1" marker-end="url(#a-green)" opacity="0.3"/>
  <!-- engine ‚Üí Qdrant -->
  <line x1="580" y1="330" x2="480" y2="418" stroke="#4ade80" stroke-width="1" marker-end="url(#a-green)" opacity="0.3"/>
  <!-- engine ‚Üí S3 -->
  <line x1="650" y1="330" x2="740" y2="418" stroke="#4ade80" stroke-width="1" marker-end="url(#a-green)" opacity="0.3"/>
  <!-- api ‚Üî engine direct -->
  <line x1="320" y1="240" x2="438" y2="240" stroke="#60a5fa" stroke-width="1" marker-end="url(#a-blue)" opacity="0.3" stroke-dasharray="4,3"/>
  <!-- engine ‚Üî ml-worker -->
  <line x1="720" y1="260" x2="838" y2="260" stroke="#f97316" stroke-width="1" marker-end="url(#a-orange)" opacity="0.3" stroke-dasharray="4,3"/>
  <text x="780" y="254" text-anchor="middle" fill="#f97316" font-size="8" opacity="0.5">gRPC</text>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- FLOW PATHS (animated, toggled)           -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  
  <!-- Flow 1: User Query -->
  <path class="flow-path" data-flow="query" d="M85,80 L140,190 L190,245 L320,245 L440,245 L580,245 L720,260 L840,260 L970,250 L840,250 L720,250 L580,235 L440,235 L320,235 L190,235 L140,200 L85,80"
    stroke="#60a5fa" stroke-width="2.5" fill="none" marker-end="url(#a-blue)"/>
  <!-- Simplified: show as sequential hops -->
  <path class="flow-path" data-flow="query" d="M85,75 C85,140 140,185 150,190" stroke="#60a5fa" stroke-width="3" fill="none"/>
  <path class="flow-path" data-flow="query" d="M320,250 L440,250" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#a-blue)"/>
  <path class="flow-path" data-flow="query" d="M720,255 L840,255" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#a-blue)"/>
  <path class="flow-path" data-flow="query" d="M840,265 L720,265" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#a-blue)"/>
  <path class="flow-path" data-flow="query" d="M440,260 L320,260" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#a-blue)"/>

  <!-- Flow 2: Knowledge Ingestion -->
  <path class="flow-path" data-flow="ingest" d="M1075,80 L970,190" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#a-purple)"/>
  <path class="flow-path" data-flow="ingest" d="M900,195 L580,145" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#a-purple)"/>
  <path class="flow-path" data-flow="ingest" d="M400,145 L250,195" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#a-purple)"/>
  <path class="flow-path" data-flow="ingest" d="M320,260 L440,260" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#a-purple)"/>
  <path class="flow-path" data-flow="ingest" d="M520,330 L330,420" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#a-purple)"/>
  <path class="flow-path" data-flow="ingest" d="M580,330 L480,420" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#a-purple)"/>

  <!-- Flow 3: 3D Model Generation -->
  <path class="flow-path" data-flow="model3d" d="M320,250 L440,250" stroke="#f97316" stroke-width="3" fill="none" marker-end="url(#a-orange)"/>
  <path class="flow-path" data-flow="model3d" d="M520,330 L330,420" stroke="#f97316" stroke-width="3" fill="none" marker-end="url(#a-orange)"/>
  <path class="flow-path" data-flow="model3d" d="M720,260 L840,260" stroke="#f97316" stroke-width="3" fill="none" marker-end="url(#a-orange)"/>
  <path class="flow-path" data-flow="model3d" d="M840,250 L720,250" stroke="#f97316" stroke-width="3" fill="none" marker-end="url(#a-orange)"/>
  <path class="flow-path" data-flow="model3d" d="M650,330 L740,420" stroke="#f97316" stroke-width="3" fill="none" marker-end="url(#a-orange)"/>

  <!-- Flow 4: ML Flywheel -->
  <path class="flow-path" data-flow="flywheel" d="M85,75 L190,140" stroke="#4ade80" stroke-width="3" fill="none" marker-end="url(#a-green)"/>
  <path class="flow-path" data-flow="flywheel" d="M350,140 L580,140" stroke="#4ade80" stroke-width="3" fill="none" marker-end="url(#a-green)"/>
  <path class="flow-path" data-flow="flywheel" d="M580,156 L580,190" stroke="#4ade80" stroke-width="3" fill="none" marker-end="url(#a-green)"/>
  <path class="flow-path" data-flow="flywheel" d="M720,260 L840,260" stroke="#4ade80" stroke-width="3" fill="none" marker-end="url(#a-green)"/>
  <path class="flow-path" data-flow="flywheel" d="M840,250 L720,250" stroke="#4ade80" stroke-width="3" fill="none" marker-end="url(#a-green)"/>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- pkg/fn FOUNDATION BAR                    -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <rect x="60" y="520" width="1040" height="60" rx="10" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <rect x="60" y="520" width="1040" height="60" rx="10" fill="url(#g-api)" opacity="0.3"/>
  <text x="580" y="540" text-anchor="middle" fill="#60a5fa" font-size="12" font-weight="700" letter-spacing="1">pkg/fn ‚Äî Generic Functional Toolkit</text>
  
  <!-- fn items in the bar -->
  <text x="100" y="565" fill="#94a3b8" font-size="10" font-family="'SF Mono',monospace">Result[T]</text>
  <text x="210" y="565" fill="#94a3b8" font-size="10" font-family="'SF Mono',monospace">Map/Filter/Reduce</text>
  <text x="380" y="565" fill="#94a3b8" font-size="10" font-family="'SF Mono',monospace">Stage[In,Out]</text>
  <text x="520" y="565" fill="#94a3b8" font-size="10" font-family="'SF Mono',monospace">FanOut/Batch</text>
  <text x="660" y="565" fill="#94a3b8" font-size="10" font-family="'SF Mono',monospace">Retry[T]</text>
  <text x="770" y="565" fill="#94a3b8" font-size="10" font-family="'SF Mono',monospace">Chain</text>
  <text x="860" y="565" fill="#94a3b8" font-size="10" font-family="'SF Mono',monospace">Repository[T]</text>
  <text x="1000" y="565" fill="#94a3b8" font-size="10" font-family="'SF Mono',monospace">GroupBy/Chunk</text>
  
  <!-- dotted lines from services down to foundation -->
  <line x1="190" y1="330" x2="190" y2="518" stroke="#334155" stroke-width="0.8" stroke-dasharray="3,4" opacity="0.4"/>
  <line x1="580" y1="330" x2="580" y2="518" stroke="#334155" stroke-width="0.8" stroke-dasharray="3,4" opacity="0.4"/>
  <line x1="970" y1="330" x2="970" y2="518" stroke="#334155" stroke-width="0.8" stroke-dasharray="3,4" opacity="0.3"/>
  <text x="190" y="510" text-anchor="middle" fill="#475569" font-size="8">imports</text>
  <text x="580" y="510" text-anchor="middle" fill="#475569" font-size="8">imports</text>
</svg>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- pkg/fn DETAIL CARDS                         -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="section-divider" style="margin-top:12px"></div>
<h2>üì¶ pkg/fn ‚Äî Generic Functional Toolkit</h2>
<div class="fn-grid">
  <div class="fn-card">
    <h4>Result[T]</h4>
    <p>Chainable error handling. Wraps value + error into a monadic type. Eliminates <code>if err != nil</code> chains.</p>
  </div>
  <div class="fn-card">
    <h4>Map / Filter / Reduce</h4>
    <p>Generic collection operations. Type-safe transforms over slices without manual loops.</p>
  </div>
  <div class="fn-card">
    <h4>GroupBy / Chunk / Unique</h4>
    <p>Partition, batch, and deduplicate collections. Used in ingestion batching and graph aggregation.</p>
  </div>
  <div class="fn-card">
    <h4>Stage[In, Out]</h4>
    <p>Pipeline stage with typed input/output. Compose with <code>.Then()</code> for sequential processing.</p>
  </div>
  <div class="fn-card">
    <h4>FanOut / BatchStage</h4>
    <p>Parallel execution and batched processing. FanOut runs N stages concurrently, BatchStage chunks work.</p>
  </div>
  <div class="fn-card">
    <h4>Retry[T]</h4>
    <p>Generic retry with backoff. Wraps any <code>func() Result[T]</code> with configurable attempts and delay.</p>
  </div>
  <div class="fn-card">
    <h4>Chain</h4>
    <p>Middleware composition. Stack handlers like <code>Chain(auth, rateLimit, log)(handler)</code>.</p>
  </div>
  <div class="fn-card">
    <h4>Repository[T]</h4>
    <p>Generic data access interface. CRUD operations typed to entity. Implementations for PG, Neo4j, Qdrant.</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- COMPARISON SECTION                          -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="section-divider"></div>
<h2>üìä Architecture Reduction</h2>
<div class="comparison">
  <div class="cmp-card before">
    <h3>‚ùå Before</h3>
    <div class="stat"><span class="label">Services</span><span class="val">8</span></div>
    <div class="stat"><span class="label">Design Patterns</span><span class="val">30+</span></div>
    <div class="stat"><span class="label">Directories</span><span class="val">~120</span></div>
    <div style="margin-top:12px">
      <div class="bar-row"><span class="bar-label">Services</span><div class="bar-track"><div class="bar-fill before" style="width:100%"></div></div></div>
      <div class="bar-row"><span class="bar-label">Patterns</span><div class="bar-track"><div class="bar-fill before" style="width:100%"></div></div></div>
      <div class="bar-row"><span class="bar-label">Dirs</span><div class="bar-track"><div class="bar-fill before" style="width:100%"></div></div></div>
    </div>
  </div>
  <div class="cmp-arrow">‚Üí</div>
  <div class="cmp-card after">
    <h3>‚úÖ After</h3>
    <div class="stat"><span class="label">Services</span><span class="val">3</span></div>
    <div class="stat"><span class="label">Design Patterns</span><span class="val">8</span></div>
    <div class="stat"><span class="label">Directories</span><span class="val">~15</span></div>
    <div style="margin-top:12px">
      <div class="bar-row"><span class="bar-label">Services</span><div class="bar-track"><div class="bar-fill after" style="width:37.5%"></div></div></div>
      <div class="bar-row"><span class="bar-label">Patterns</span><div class="bar-track"><div class="bar-fill after" style="width:26.7%"></div></div></div>
      <div class="bar-row"><span class="bar-label">Dirs</span><div class="bar-track"><div class="bar-fill after" style="width:12.5%"></div></div></div>
    </div>
  </div>
</div>

<p class="footer">Wessley.ai Design Patterns Architecture ¬∑ February 2026</p>

<!-- Tooltip -->
<div class="tip" id="tooltip"></div>

<script>
// Tooltip
const tip = document.getElementById('tooltip');
document.querySelectorAll('[data-tip]').forEach(el => {
  el.addEventListener('mouseenter', e => {
    tip.innerHTML = el.getAttribute('data-tip');
    tip.classList.add('show');
  });
  el.addEventListener('mousemove', e => {
    let x = e.clientX + 16, y = e.clientY + 12;
    if (x + 380 > window.innerWidth) x = e.clientX - 396;
    if (y + 200 > window.innerHeight) y = e.clientY - 200;
    tip.style.left = x + 'px';
    tip.style.top = y + 'px';
  });
  el.addEventListener('mouseleave', () => tip.classList.remove('show'));
});

// Flow toggle
let activeFlow = null;
function toggleFlow(flow, btn) {
  if (activeFlow === flow) {
    // deactivate
    activeFlow = null;
    btn.classList.remove('active');
    document.querySelectorAll('.flow-path').forEach(p => p.classList.remove('visible'));
    return;
  }
  activeFlow = flow;
  document.querySelectorAll('.flow-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.flow-path').forEach(p => {
    p.classList.toggle('visible', p.getAttribute('data-flow') === flow);
  });
}
</script>
</body>
</html>
